# Authentication
# Set up the following secrets in your GitHub repository: 
#
#   AZURE_CREDENTIALS
#
# For details on usage of secrets, please refer to:
#  https://help.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets

name: GitHub Workflows

on: 
  workflow_dispatch:
    inputs:
      AZURE_LOCATION: 
        type: string
        description: 'Azure region name'
        required: true
        default: 'australiaeast'
      AZURE_SUBSCRIPTION_ID:
        type: string
        description: 'Azure subscription id'
        required: true
      AZURE_RESOURCEGROUP_NAME:
        type: string
        description: 'Azure resource group name'
        required: true  

jobs:      
  azureTemplates:
    uses: ./.github/workflows/azure-templates.yml
    with:
      AZURE_LOCATION: ${{ inputs.AZURE_LOCATION }}
      AZURE_SUBSCRIPTION_ID: ${{ inputs.AZURE_SUBSCRIPTION_ID }}
      AZURE_RESOURCEGROUP_NAME: ${{ inputs.AZURE_RESOURCEGROUP_NAME }}
    secrets: inherit

  dockerImagesUbuntu:
    needs: azureTemplates
    uses: ./.github/workflows/docker-images-ubuntu.yml
    with:
      AZURE_KEYVAULT_NAME: ${{ needs.azureTemplates.outputs.AZURE_KEYVAULT_NAME }}
    secrets: inherit

  dockerImagesNextflow:
    needs: azureTemplates
    uses: ./.github/workflows/docker-images-nextflow.yml
    with:
      AZURE_KEYVAULT_NAME: ${{ needs.azureTemplates.outputs.AZURE_KEYVAULT_NAME }}
    secrets: inherit

  dockerImagesNxfutil:
    needs: azureTemplates
    uses: ./.github/workflows/docker-images-nxfutil.yml
    with:
      AZURE_KEYVAULT_NAME: ${{ needs.azureTemplates.outputs.AZURE_KEYVAULT_NAME }}
    secrets: inherit        

  azureFunctions:
    needs: azureTemplates
    uses: ./.github/workflows/azure-functions.yml
    with:
      AZURE_FUNCTIONAPP_NAME: ${{ needs.azureTemplates.outputs.AZURE_FUNCTIONAPP_NAME }}
    secrets: inherit    